# set C++ language standard
set (CMAKE_CXX_EXTENSIONS OFF)

# add tests
file (GLOB testsources *.cpp)
foreach (testsourcefile ${testsources})
  get_filename_component (exename ${testsourcefile} NAME_WE)
  add_executable (${exename} ${testsourcefile})
  target_link_libraries (${exename} pegtl)
  if (MSVC)
    target_compile_options (${exename} /W4 /WX /utf-8)
  else ()
    target_compile_options (${exename} -pedantic -Wall -Wextra -Wshadow -Werror)
  endif ()
  if (ANDROID_NDK)
    add_test (NAME ${exename} WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/../../.. COMMAND ${CMAKE_CURRENT_SOURCE_DIR}/run-on-android.sh ${CMAKE_CURRENT_BINARY_DIR}/${exename})
  else ()
    add_test (NAME ${exename} WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/../../.. COMMAND ${CMAKE_CURRENT_BINARY_DIR}/${exename})
  endif ()
endforeach (testsourcefile)
