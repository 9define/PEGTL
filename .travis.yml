language: android
sudo: false
jdk: openjdk7
android:
  components:
    - tools
    - build-tools-23.0.3
    - extra-android-support
    - extra-android-m2repository
    - android-22
    - sys-img-armeabi-v7a-android-22
    - cmake 
  licenses:
    - '.+'
before_script:
  - export TERM=dumb
  - curl -L http://dl.google.com/android/repository/android-ndk-r10e-linux-x86_64.zip -O
  - unzip -q android-ndk-r10e-linux-x86_64.zip
  - export ANDROID_NDK_HOME=`pwd`/android-ndk-r10e
  - export LOCAL_ANDROID_NDK_HOME="$ANDROID_NDK_HOME"
  - export LOCAL_ANDROID_NDK_HOST_PLATFORM="linux-x86_64"
  - export PATH=$PATH:${ANDROID_NDK_HOME}
  - export CMAKE_VERSION=3.6.2
  - curl -L https://cmake.org/files/v3.6/cmake-${CMAKE_VERSION}-Linux-x86_64.tar.gz -O
  - tar xzf cmake-${CMAKE_VERSION}-Linux-x86_64.tar.gz
  - export PATH=cmake-${CMAKE_VERSION}-Linux-x86_64/bin:$PATH
  - export _NO_CHECK_SIGNATURE=true
  - echo no | android create avd --force -n test -t android-22 --abi armeabi-v7a
  - emulator -avd test -no-audio -no-window &
  - android-wait-for-emulator
script:
  - cmake -DANDROID_NDK="$ANDROID_NDK_HOME" -DPEGTL_PLATFORM=Android -DANDROID_ABI=armeabi-v7a
  - make
  - make test
  - ./run-on-android.sh
